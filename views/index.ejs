<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script type="text/javascript" src="/javascripts/htmlparser.js"></script>
    <script type="text/javascrip"  src="/javascripts/he.js"></script>
  	<script type="text/javascript">
  		var parse = function(str){
  			var results = '';
  			try{
  					HTMLParse(he.unescape(str,{strict:true}),{
  						start: function(tag,attrs,unary){
  							results+='<'+tag;
  							for(var i=0,len=attrs.length;i<len; i++){
  								results+=" "+attrs[i].name+'="'+attrs[i].escaped+'"';
  							}
  							results+=(unary?"/":"")+">"
  						},
  						end:function(tag){
  							results+="</"+tag+">";
  						},
  						chars:function(text){
  							results+=text;
  						},
  						comment:function(text){
  							results+="<!--"+tetx+"-->"
  						}
  					});
  			}catch(e){
  					console.log(e)
  			}finally{

  			}
  		}
  	</script>
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>
    <textarea name="name" rows="8" cols="80" id="text">
    	<p>sks<img src="null" alt="" onerror="alert(1)"></p>
    </textarea>
    <button type="button" name="button" id="btn">评论</button>
    <button type="button" name="button" id="get">评论</button>

    <script type="text/javascript">
    	var btn = document.getElementById('btn');
    	var get = document.getElementById('get');
    	var text = document.getElementById('text');
    	btn.addEventListener('click',function(){
    		var xhr = new XMLHttpRequest();
    		var url = '/comment?comment+text.value';
    		xhr.open("GET",url,true);
    		xhr.send();
    		xhr.onreadyStatechange =function(){
    			if(xhr.readyState ===4){
    				if(xhr.status === 200|| xhr.status ===304){
    					console.log(xhr)
    				}else{
    					console.log(error)
    				}
    			}
    		}
    	})
    	get.addEventListener('click',function(){
    		var xhr = new XMLHttpRequest();
    		var url = '/getComment';
    		xhr.open("GET",url,true);
    		xhr.send();
    		xhr.onreadyStatechange =function(){
    			if(xhr.readyState ===4){
    				if(xhr.status === 200|| xhr.status ===304){
    					var com=parse(JSON.parse(xhr.response).comment);
    					var text = document.createElement('span');
    					text.innerHTML = com;
    					document.body.appendChild(text);
    				}else{
    					console.log(error)
    				}
    			}
    		}
    	})
;

    </script>
  </body>
</html>
